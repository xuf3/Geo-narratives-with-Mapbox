
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Scrollytelling Template</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <!-- set the title for the story map -->
<div class = "light" id = "header">
  <h1>Title here</h1>
  <h2>Subtitle here</h2>
</div>

<div id="map"></div>

<div id="story"><div id="features"></div></div>

<!-- adding the story feature for each page -->
<script src="js/story_xu.js"></script>
<script src="js/layers_xu.js"></script>
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoieHVmMyIsImEiOiJjazUzZTQ0bWEwN3BjM2xtYzAxd2NvcXJ3In0.Fyg85XmzmWQs_nLgf7DXdg';

var scroller = scrollama();

var mapStyle = 'light-v10'

//initialize the map, location, style
var map = new mapboxgl.Map({
  container: 'map',
  center: [-122.319,47.614],
  zoom: 17,
  pitch: 40.00,
  bearing: 30.00,
  //'light-v10','dark-v10'.'outdoors-v11','satellite-v9','streets-v11'
  style: 'mapbox://styles/mapbox/' + mapStyle,
});

function getLayerPaintType(layer) {
    var layerType = map.getLayer(layer).type;
    return layerTypes[layerType];
}

//show or hide the layer
function setLayerOpacity(layer) {
    var paintProps = getLayerPaintType(layer.layer);
    paintProps.forEach(function(prop) {
        map.setPaintProperty(layer.layer, prop, layer.opacity);
    });
}

//add all layers to the map will 0 opacity


map.on("load", function() {
    // setup the instance, pass callback functions
    layers.forEach(function(feature){
      map.addSource(feature.id,feature.source);
      map.addLayer(feature.layer);
    });
    scroller
    .setup({
        step: '.step',
        offset: 0.5,
        progress: true
    })
    .onStepEnter(response => {
        var chapter = chapters.find(chap => chap.id === response.element.id);
        //active chapter's storyboard
        response.element.classList.add('active');
        //change the center of location
        map.flyTo(chapter.location);
        //change the basemap
        if(chapter.changestyle){
          map.setStyle('mapbox://styles/mapbox/' + chapter.changestyle);
        }
        //show the layer
        if (chapter.show.length > 0) {
            chapter.show.forEach(setLayerOpacity);
        }
    })
    .onStepExit(response => {
        var chapter = chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.hide.length > 0) {
            chapter.hide.forEach(setLayerOpacity);
        }
    });
});

</script>
</body>
</html>
