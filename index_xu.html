
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Scrollytelling Template</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <!-- set the title for the story map -->
<div class = "light" id = "header">
  <h1>Title here</h1>
  <h2>Subtitle here</h2>
</div>

<div id="map"></div>

<div id="story"><div id="features"></div></div>

<!-- adding the story feature for each page -->
<script src="js/story_xu.js"></script>
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoieHVmMyIsImEiOiJjazUzZTQ0bWEwN3BjM2xtYzAxd2NvcXJ3In0.Fyg85XmzmWQs_nLgf7DXdg';
//'light-v10','dark-v10'.'outdoors-v11','satellite-v9','streets-v11'
var map_style = 'satellite-v9';

var map = new mapboxgl.Map({
  container: 'map',
  zoom: 14,
  pitch: 60,
  bearing: 40,
  center: [137.9150899566626, 36.25956997955441],
  style: 'mapbox://styles/mapbox/' + map_style
});

function addlayer(feature){
  map.addSource(feature.addGeo[0].id, feature.addGeo[0].source);
  map.addLayer(cfeature.addGeo[0].layer);
}

var scroller = scrollama();

map.on("load", function() {
    // setup the instance, pass callback functions
    scroller
    .setup({
        step: '.step',
        offset: 0.5,
        progress: true
    })
    .onStepEnter(response => {
        var chapter = chapters.find(chap => chap.id === response.element.id);
        response.element.classList.add('active');
        map.flyTo(chapter.location);
        if(chapter.changestyle){
          map.setStyle('mapbox://styles/mapbox/' + chapter.changestyle);
        }
        if (chapter.onChapterEnter.length > 0) {
            chapter.onChapterEnter.forEach(setLayerOpacity);
        }
        if (chapter.addlayer > 0) {
            map.addSource(chapter.addGeo[0].id, chapter.addGeo[0].source);
            map.addLayer(chapter.addGeo[0].layer);
            //chapter.addGeo.forEach(setLayerOpacity);
        }
    })
    .onStepExit(response => {
        var chapter = chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.onChapterExit.length > 0) {
            chapter.onChapterExit.forEach(setLayerOpacity);
        }
        if (chapter.removeGeo.length > 0) {
            map.removeLayer(chapter.removeGeo[0].layer);
            //map.removeLayer(chapter.removeGeo[0].id);
        }
        if (chapter.removeRaster.length > 0) {
          map.removeLayer(chapter.removeRaster[0].layer);
            //map.removeLayer(chapter.removeGeo[0].layer);
        }
    });
});

</script>
</body>
</html>
