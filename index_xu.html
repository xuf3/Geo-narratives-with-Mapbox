
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Scrollytelling Template</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<div class = "light" id = "header">
  <h1>Title here</h1>
  <h2>Subtitle here</h2>
</div>
<div id="map"></div>
<div id="story"></div>
<script src="js/config.js"></script>
<script>

  function setLayer(layer) {
    map.addSource(chapter.addLayer[0].id, chapter.addLayer[0].source);
    map.addLayer(chapter.addLayer[0].layer);
  }

  function removeLayer(layer) {
    map.addSource(chapter.addLayer[0].id, chapter.addLayer[0].source);
    map.addLayer(chapter.addLayer[0].layer);
  }

  var map = new mapboxgl.Map({
      container: 'map',
      style: config.style,
      center: config.chapters[0].location.center,
      zoom: config.chapters[0].location.zoom,
      bearing: config.chapters[0].location.bearing,
      pitch: config.chapters[0].location.pitch,
      scrollZoom: false,
      transformRequest: transformRequest
  });

map.on("load", function() {
    // setup the instance, pass callback functions
    scroller
    .setup({
        step: '.step',
        offset: 0.5,
        progress: true
    })
    .onStepEnter(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.add('active');
        map.flyTo(chapter.location);
        //map.setStyle(config.style);
        if (config.showMarkers) {
            marker.setLngLat(chapter.location.center);
        }
        if (chapter.mapLayer.length > 0) {
            chapter.mapLayer.forEach(setLayer);
        }
    })
    .onStepExit(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.removeLayer.length > 0) {
            chapter.removeLayer.forEach(
            map.setPaintProperty(removeLayer[0],'raster-opacity',0))
        }
    });
});

// setup resize event
window.addEventListener('resize', scroller.resize);

</script>

</body>
</html>
